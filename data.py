import numpy as np
import matplotlib.pyplot as plt
from sklearn.linear_model import LinearRegression
import pandas as pd
from datetime import datetime
# -  数据来源：http://m.lufangjia.com/#/city?city=%E6%88%90%E9%83%BD&district=%E5%85%A8%E5%B8%82&show=daily
# -  循环得出需要的数据，
# -  np_array下加载出需要的矩阵
# -  最痛苦的就是数据格式的转换，先由str转为datetime.datetime再转为float
# -  缘由：shenyi的视频看到线性回归或者是最小二乘法，想到成都最近的房价走势和这个有点像，也可以测下理论值。纪念一下，照这个趋势，2018年2月15日的价格是1.7704742万元。
test_data = [{"unit_price":"1.2813424514978073","date":"2017-05-14"},{"unit_price":"1.2820898495131305","date":"2017-05-15"},{"unit_price":"1.2839536074930484","date":"2017-05-16"},{"unit_price":"1.2854210296684119","date":"2017-05-17"},{"unit_price":"1.2845476381104886","date":"2017-05-18"},{"unit_price":"1.285566502463054","date":"2017-05-19"},{"unit_price":"1.2863014092608571","date":"2017-05-20"},{"unit_price":"1.289155334916181","date":"2017-05-21"},{"unit_price":"1.2907924582821642","date":"2017-05-22"},{"unit_price":"1.2934031526668106","date":"2017-05-23"},{"unit_price":"1.2965284825959544","date":"2017-05-24"},{"unit_price":"1.2952862840051276","date":"2017-05-25"},{"unit_price":"1.2965314804310832","date":"2017-05-26"},{"unit_price":"1.2958865398167725","date":"2017-05-27"},{"unit_price":"1.2967571569595262","date":"2017-05-28"},{"unit_price":"1.2979460418885338","date":"2017-05-29"},{"unit_price":"1.2986796075085325","date":"2017-05-30"},{"unit_price":"1.3005014478423618","date":"2017-05-31"},{"unit_price":"1.3001982007309532","date":"2017-06-01"},{"unit_price":"1.301051383950359","date":"2017-06-02"},{"unit_price":"1.3007108742299438","date":"2017-06-03"},{"unit_price":"1.302889684123598","date":"2017-06-04"},{"unit_price":"1.3039082909390898","date":"2017-06-05"},{"unit_price":"1.3035279638999044","date":"2017-06-06"},{"unit_price":"1.3036425370093712","date":"2017-06-07"},{"unit_price":"1.3041961871281773","date":"2017-06-08"},{"unit_price":"1.3056288757077381","date":"2017-06-09"},{"unit_price":"1.305966921119593","date":"2017-06-10"},{"unit_price":"1.3080295138888889","date":"2017-06-11"},{"unit_price":"1.308782857523125","date":"2017-06-12"},{"unit_price":"1.3088582729070535","date":"2017-06-13"},{"unit_price":"1.3099680532011997","date":"2017-06-14"},{"unit_price":"1.3111891751236013","date":"2017-06-15"},{"unit_price":"1.3113612191958495","date":"2017-06-16"},{"unit_price":"1.311695222085731","date":"2017-06-17"},{"unit_price":"1.311971141458387","date":"2017-06-18"},{"unit_price":"1.3153111926369312","date":"2017-06-19"},{"unit_price":"1.3179489318021427","date":"2017-06-20"},{"unit_price":"1.3199923469387755","date":"2017-06-21"},{"unit_price":"1.3188637954068325","date":"2017-06-22"},{"unit_price":"1.3207059346803915","date":"2017-06-23"},{"unit_price":"1.3220776760341015","date":"2017-06-24"},{"unit_price":"1.3240005038417937","date":"2017-06-25"},{"unit_price":"1.3256381769978538","date":"2017-06-26"},{"unit_price":"1.3267521796399673","date":"2017-06-27"},{"unit_price":"1.3273821168798596","date":"2017-06-28"},{"unit_price":"1.3292512935602518","date":"2017-06-29"},{"unit_price":"1.3286710509988833","date":"2017-06-30"},{"unit_price":"1.3292256514507486","date":"2017-07-01"},{"unit_price":"1.3310520167240532","date":"2017-07-02"},{"unit_price":"1.3319715197643014","date":"2017-07-03"},{"unit_price":"1.3329488042082085","date":"2017-07-04"},{"unit_price":"1.333307785888078","date":"2017-07-05"},{"unit_price":"1.333446232006774","date":"2017-07-06"},{"unit_price":"1.3344358540710315","date":"2017-07-07"},{"unit_price":"1.3360127534139445","date":"2017-07-08"},{"unit_price":"1.337869541714217","date":"2017-07-09"},{"unit_price":"1.3392675581255271","date":"2017-07-10"},{"unit_price":"1.3392728586047071","date":"2017-07-11"},{"unit_price":"1.3405084847394615","date":"2017-07-12"},{"unit_price":"1.342094828615789","date":"2017-07-13"},{"unit_price":"1.341571870537839","date":"2017-07-14"},{"unit_price":"1.3424566080208518","date":"2017-07-15"},{"unit_price":"1.3443404708387554","date":"2017-07-16"},{"unit_price":"1.3449668049792531","date":"2017-07-17"},{"unit_price":"1.3462129547471162","date":"2017-07-18"},{"unit_price":"1.34754201433776","date":"2017-07-19"},{"unit_price":"1.3492801123727027","date":"2017-07-20"},{"unit_price":"1.348754999130586","date":"2017-07-21"},{"unit_price":"1.3481314144831145","date":"2017-07-22"},{"unit_price":"1.3487114718737583","date":"2017-07-23"},{"unit_price":"1.348822965427782","date":"2017-07-24"},{"unit_price":"1.348422585704683","date":"2017-07-25"},{"unit_price":"1.3488518497975484","date":"2017-07-26"},{"unit_price":"1.3486902791570121","date":"2017-07-27"},{"unit_price":"1.3478051572807066","date":"2017-07-28"},{"unit_price":"1.347661020606322","date":"2017-07-29"},{"unit_price":"1.3482194495019815","date":"2017-07-30"},{"unit_price":"1.3487550715353407","date":"2017-07-31"},{"unit_price":"1.3495409435864778","date":"2017-08-01"},{"unit_price":"1.3502188587701718","date":"2017-08-02"},{"unit_price":"1.3502232543410566","date":"2017-08-03"},{"unit_price":"1.3644761674328576","date":"2017-08-04"},{"unit_price":"1.3660703280768534","date":"2017-08-05"},{"unit_price":"1.3690057979859627","date":"2017-08-06"},{"unit_price":"1.3704539067750015","date":"2017-08-07"},{"unit_price":"1.371363608803735","date":"2017-08-08"},{"unit_price":"1.371641863278887","date":"2017-08-09"},{"unit_price":"1.3727231522330332","date":"2017-08-10"},{"unit_price":"1.3744044821977228","date":"2017-08-11"},{"unit_price":"1.3762159715096276","date":"2017-08-12"},{"unit_price":"1.3801032691720134","date":"2017-08-13"},{"unit_price":"1.3823673719717877","date":"2017-08-14"},{"unit_price":"1.3843041953814532","date":"2017-08-15"},{"unit_price":"1.3846256928793326","date":"2017-08-16"},{"unit_price":"1.3874785623061485","date":"2017-08-17"},{"unit_price":"1.3866396074392682","date":"2017-08-18"},{"unit_price":"1.3871405945419102","date":"2017-08-19"},{"unit_price":"1.3882685749086479","date":"2017-08-20"},{"unit_price":"1.392004575527113","date":"2017-08-21"},{"unit_price":"1.392999014292755","date":"2017-08-22"},{"unit_price":"1.3956880284278885","date":"2017-08-23"},{"unit_price":"1.399946114751087","date":"2017-08-24"},{"unit_price":"1.399334144856969","date":"2017-08-25"},{"unit_price":"1.401658242494367","date":"2017-08-26"},{"unit_price":"1.4060894785560012","date":"2017-08-27"},{"unit_price":"1.4071387158453093","date":"2017-08-28"},{"unit_price":"1.4069208211143696","date":"2017-08-29"},{"unit_price":"1.410098486230166","date":"2017-08-30"},{"unit_price":"1.4121745751355301","date":"2017-08-31"},{"unit_price":"1.4119609631521344","date":"2017-09-01"},{"unit_price":"1.4213832283561814","date":"2017-09-03"},{"unit_price":"1.425035725380553","date":"2017-09-04"},{"unit_price":"1.427977880184332","date":"2017-09-05"},{"unit_price":"1.4301366840330985","date":"2017-09-06"},{"unit_price":"1.4336744214597017","date":"2017-09-07"},{"unit_price":"1.4345121047430829","date":"2017-09-08"},{"unit_price":"1.4374664605873262","date":"2017-09-09"},{"unit_price":"1.4427884554392643","date":"2017-09-10"},{"unit_price":"1.4483485354573484","date":"2017-09-11"},{"unit_price":"1.4490145798695484","date":"2017-09-12"},{"unit_price":"1.4539848571610356","date":"2017-09-13"},{"unit_price":"1.4555004485454313","date":"2017-09-14"},{"unit_price":"1.4564832505413323","date":"2017-09-15"},{"unit_price":"1.4598253611556982","date":"2017-09-16"},{"unit_price":"1.4619192315232308","date":"2017-09-17"},{"unit_price":"1.4639125279936767","date":"2017-09-18"},{"unit_price":"1.4662336895941248","date":"2017-09-19"},{"unit_price":"1.4718840389166448","date":"2017-09-20"},{"unit_price":"1.474977854168044","date":"2017-09-21"},{"unit_price":"1.48069816830369","date":"2017-09-22"},{"unit_price":"1.4814149050040137","date":"2017-09-23"},{"unit_price":"1.4879735833561456","date":"2017-09-24"},{"unit_price":"1.4890439098366306","date":"2017-09-25"},{"unit_price":"1.495429298137073","date":"2017-09-26"},{"unit_price":"1.4987799579061714","date":"2017-09-27"},{"unit_price":"1.502882987438558","date":"2017-09-28"},{"unit_price":"1.503982710503029","date":"2017-09-29"},{"unit_price":"1.5057951593053465","date":"2017-09-30"},{"unit_price":"1.5084968944099377","date":"2017-10-01"},{"unit_price":"1.5103431270403556","date":"2017-10-02"},{"unit_price":"1.512566557193767","date":"2017-10-03"},{"unit_price":"1.5159694806103878","date":"2017-10-04"},{"unit_price":"1.516724077818841","date":"2017-10-05"},{"unit_price":"1.5201991288114498","date":"2017-10-06"},{"unit_price":"1.5241665499369659","date":"2017-10-07"},{"unit_price":"1.5280641514766145","date":"2017-10-08"},{"unit_price":"1.5331514159669846","date":"2017-10-09"},{"unit_price":"1.5359938171854142","date":"2017-10-10"},{"unit_price":"1.5392921153178187","date":"2017-10-11"},{"unit_price":"1.5427060575968223","date":"2017-10-12"},{"unit_price":"1.5454874928936895","date":"2017-10-13"},{"unit_price":"1.5498345908299476","date":"2017-10-14"},{"unit_price":"1.5493700894992144","date":"2017-10-15"},{"unit_price":"1.560680998306707","date":"2017-10-16"},{"unit_price":"1.5630789570326846","date":"2017-10-17"},{"unit_price":"1.5667255861514864","date":"2017-10-18"},{"unit_price":"1.5684226557400827","date":"2017-10-19"},{"unit_price":"1.5723153879372391","date":"2017-10-20"},{"unit_price":"1.5749031371982072","date":"2017-10-21"},{"unit_price":"1.5812077188348375","date":"2017-10-22"},{"unit_price":"1.5832571974148062","date":"2017-10-23"},{"unit_price":"1.5847048184054406","date":"2017-10-24"},{"unit_price":"1.5892817359855334","date":"2017-10-25"},{"unit_price":"1.5911336118388446","date":"2017-10-26"},{"unit_price":"1.592523292469352","date":"2017-10-27"},{"unit_price":"1.596949294594217","date":"2017-10-28"},{"unit_price":"1.604391356205711","date":"2017-10-29"},{"unit_price":"1.6044988817444785","date":"2017-10-30"},{"unit_price":"1.6040682631434076","date":"2017-10-31"},{"unit_price":"1.6124100199573326","date":"2017-11-01"},{"unit_price":"1.6171283691805063","date":"2017-11-02"},{"unit_price":"1.618796649916248","date":"2017-11-03"},{"unit_price":"1.622756299160112","date":"2017-11-04"},{"unit_price":"1.627858486762532","date":"2017-11-05"},{"unit_price":"1.6293712212817413","date":"2017-11-06"},{"unit_price":"1.630892739491369","date":"2017-11-07"},{"unit_price":"1.6339510187827704","date":"2017-11-08"},{"unit_price":"1.633939735846552","date":"2017-11-09"}];
x_date = []
y = []
for test in test_data:
    x_date += ((datetime.strptime(test['date'],'%Y-%m-%d')).timestamp(),)
    y += (test['unit_price'],)

x = np.array(x_date)
y = np.array(y)

lr=LinearRegression()
lr.fit(x.reshape(-1,1),y.reshape(-1,1))

tmp = datetime.strptime('2017-11-12','%Y-%m-%d').timestamp()
testX=np.array(tmp).reshape(-1,1)

newY=lr.predict(testX)
print(newY)
